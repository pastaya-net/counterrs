name: Rust

on:
  workflow_dispatch:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

env:
  CARGO_TERM_COLOR: always

jobs:
  close-issues:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: write
    steps:
      - uses: actions/stale@v10
        with:
          days-before-issue-stale: 30
          days-before-issue-close: 14
          stale-issue-label: "stale"
          stale-issue-message: "ayo guys this issue didn't have a new message since a month!! marking as stale!"
          close-issue-message: "closed issue cuz 2 weeks have passed since this issue was stale. sorry!!!!! maybe reopen again?"
          days-before-pr-stale: -1
          days-before-pr-close: -1
          repo-token: ${{ secrets.GITHUB_TOKEN }}
  build:
    runs-on: ubuntu-latest

    steps:

    - uses: actions/checkout@v4
    - name: cache sum stuff thats better that doesnt eat my ci minutes
      uses: Swatinem/rust-cache@v2.8.1
    - name: build
      run: cargo build --verbose
    - name: run tests
      run: cargo test --verbose
    - name: lint
      run: cargo clippy --no-deps
